tags:: metasploit, windows, task, privesc

- #+BEGIN_QUOTE
  *From [juggernaut-sec.com](https://juggernaut-sec.com/scheduled-tasks/#CVE-2018-8440_%E2%80%93_A_Scheduled_Task_Kernel_Exploit)*
  #+END_QUOTE
- `CVE-2018-8440` is a vulnerability that affects Windows versions up to 1803 as well as Windows Server 2008, 2012, and 2016.
- This exploit leverages **weak permissions** of the `C:\windows\tasks` folder as well as **a flaw** in the Task Scheduler API function “SchRpcSetSecurity”. Essentially, this flaw allows a standard user to call the API function and set file permissions on any local file they want.
- You need to check the `C:\Windows\Tasks` folder permissions using either `icacls` or `accesschk`.
  logseq.order-list-type:: number
  You need both *Read* and *Execute* as well as write permissions for the authenticated users group.
	- With `icacls`
	  logseq.order-list-type:: number
	  ```powershell
	  icacls "C:\Windows\Tasks"
	  ```
	  ![](https://juggernaut-sec.com/wp-content/uploads/2022/06/image-296.png)
	- With `accesschk````
	  logseq.order-list-type:: number
	  powershell
	  .\accesschk64.exe -wvud "C:\WIndows\Tasks"
	  ```
	  ![](https://juggernaut-sec.com/wp-content/uploads/2022/06/image-297.png)
- Exploit it via Metasploit
  logseq.order-list-type:: number
	- logseq.order-list-type:: number